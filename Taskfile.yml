version: '3'
dotenv: ['../.env','.env']
vars:
  MODULE_NAME: "Logging App"
  EXE_NAME: "smlogger"

includes:
  version: ../Taskfile.version.yml
  production: ../Taskfile.prod.yml

tasks:
  default:
    desc: "Development build of {{.MODULE_NAME}}"

    cmds:
      - echo "Running..."
      - go vet ./...
      - task: format
      - wails dev -ldflags "-X main.version=Dev"

  update:
    cmds:
      - go get -u
      - go mod tidy
      - go mod verify
      - task: frontend

  frontend:
    dir: frontend
    cmds:
      - npm update

  format:
    dir: frontend
    cmds:
      - npm run format
      - npm run lint

  prod:
    cmds:
      - task: production:prod
      - task: deploy

  deploy:
    desc: "Local deployment of the {{.MODULE_NAME}} module"
    cmds:
      - wails build -ldflags "-X main.version=$(cat {{.VERSION_FILE}} 2>/dev/null || echo '0.0.0')" -o {{.EXE_NAME}}
      - sudo cp -f {{.SM_WORKING_DIR}}/bin/{{.EXE_NAME}} {{.DEPLOY_DIR}}/{{.EXE_NAME}}
      - echo "âœ“ {{.MODULE_NAME}} v$(cat {{.VERSION_FILE}} 2>/dev/null || echo '0.0.0') deployed"
